---
output:
  html_document:
    self_contained: no
  pdf_document: default
---

## Demographics for Data and Software Carpentry Learners
__Revised:__ 2018-07-12    
__Lead:__ [Kari L. Jordan](https://github.com/kariljordan), Director of Assessment and Community Equity 

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(likert)
library(srvyr)
library(NPS)
library(broom)
library(assertr)
library(viridis)
library(patchwork)
library(scales)
library(ggalt)

opts_chunk$set(echo = FALSE,
               message = FALSE,
               warning = FALSE)
## puts all figures in figures folder
opts_chunk$set(fig.path='figures/', fig.width = 10,  fig.retina = 2)


to_snake_case <- function(x) {
    x <- gsub("([A-Z])([A-Z][a-z]+)", "\\1_\\2", x)
    tolower(gsub("([a-z])([A-Z])", "\\1_\\2", x))
}

## returns TRUE when the respondent has answered at least one question.
has_answers <- function(d) {
    d %>%
        select(-matches("date")) %>%
        mutate(has_answers = rowSums(is.na(.)) < ncol(.)) %>%
        pull(has_answers)   
}


convert_label <- function(x) {
    x <- gsub("_([a-z])", " \\U\\1", x, perl = TRUE)
    x <- gsub("^([a-z])", "\\U\\1", x, perl = TRUE)
    gsub("sql", "SQL", x, ignore.case = TRUE)
}



ggassessment_hist <- function(data, mapping) {
    ggplot(data, mapping) +
        geom_col(fill = "darkcyan") +
        geom_text(aes(label = n), size = 4, nudge_y = 3) +
        scale_x_discrete(labels = function(x)
            lapply(strwrap(x, width = 10, simplify = FALSE),
                   paste, collapse = "\n")) +
        ylab("% Respondents") +
        theme_classic(base_size = 14)
}

ggassessment_lolli <- function(data, mapping, color) {
    data$percent <- data$percent / 100
    if (!identical(substr(color, 1, 1), "#")) {
        color <- match.arg(color, c("swc", "dc", "cp"))
        color <- switch(color,
                        swc = "#2f3f8e",
                        dc  = "darkcyan",
                        cp = "#071159")
    }
    
    ggplot(data, mapping) +
        geom_lollipop(col = color, horizontal = TRUE, point.size = 2.5) +
        geom_text(aes(label = n), size = 4, nudge_x = .0125, hjust = 0) +
        scale_x_continuous(expand=c(0, 0), labels=percent,
                           breaks=seq(0, 1, by = 0.2), limits = c(0, 1)) +
        theme_minimal(base_size = 14) +
        theme(panel.grid.major.y = element_blank(),
              panel.grid.minor  = element_blank(),
              axis.line.y = element_line(color="#2b2b2b"),
              axis.text.y = element_text(margin = margin(r=0, l=0)),
              plot.margin = unit(c(5, 30, 10, 30), "pt"), 
              plot.title = element_text(margin = margin(r = 100, b = 10),
                                        face="bold"), 
              plot.subtitle = element_text(margin = margin(b = 10)), 
              plot.caption = element_text(size = 10, margin = margin(t = 10))) +
        labs(x = "% Respondents",
             y = "", 
             caption = "Numbers of answers reported on the graph")

}



make_likert_data <- function(.data, var_levels) {
    .data %>% 
        mutate_all(~ factor(., levels = var_levels, ordered = TRUE)) %>%
        as.data.frame() %>% 
        likert() %>%
        transform_likert_labels()     
}

```


```{r load-dc-data}
# Load DC pre and post-workshop data
# Data Carpentry Pre-Workshop Data
dcpredata <- readr::read_csv("https://raw.githubusercontent.com/carpentries/equity-and-inclusion/master/data/180511_dcpre.csv",
                             col_types = cols(
                                 Date =  col_datetime(
                                     format = "%m/%d/%y %H:%M"
                                 ),
                                 .default = "c")
                             ) %>%
    rename(
        ## ---- discipline ----
        "discipline_1"  = Discipline,        
        "discipline_2"  = Column2, 
        "discipline_3"  = Column3, 
        "discipline_4"  = Column4, 
        "discipline_5"  = Column5, 
        "discipline_6"  = Column6, 
        "discipline_7"  = Column7, 
        "discipline_8"  = Column8, 
        "discipline_9"  = Column9, 
        "discipline_10" = Column10, 
        "discipline_11" = Column11, 
        "discipline_12" = Column12, 
        "discipline_13" = Column13,
        "discipline_other" = DisciplineOther, 
        ## ---- status ----
        "status_1" = Status, 
        "status_2" = Column15, 
        "status_3" = Column16, 
        "status_4" = Column17, 
        "status_5" = Column18, 
        "status_6" = Column19, 
        "status_7" = Column20,
        "status_8" = Column21,
        "status_9" = Column22,
        ## ---- why_attending ----
        "why_attending_1" = WhyAttending,
        "why_attending_2" = Column27,
        "why_attending_3" = Column28,
        "why_attending_4" = Column29,
        "why_attending_other" = WhyAttendingOther, 
        ## ---- exposure ----
        "exposure_1" = Exposure,
        "exposure_2" = Column31,
        "exposure_3" = Column32,
        "exposure_4" = Column33,
        "exposure_5" = Column34,
        "exposure_6" = Column35,
        "exposure_other" = ExposureOther,
        ## ---- ethnic_identiity ----
        "ethnic_identity_1" = RaceEthnicIdentity,
        "ethnic_identity_2" = Column44,
        "ethnic_identity_3" = Column45, 
        "ethnic_identity_4" = Column46,
        "ethnic_identity_5" = Column47,
        "ethnic_identity_6" = Column48,
        "ethnic_identity_7" = Column49, 
        "ethnic_identity_other" = RaceEthnicIdentityOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))

## Data Carpentry Post-Workshop Data
dcpostdata <- readr::read_csv("https://raw.githubusercontent.com/carpentries/equity-and-inclusion/master/data/180511_dcpost.csv",
                              col_types = cols(
                                  Date =  col_datetime(
                                      format = "%m/%d/%y %H:%M"
                                  ),
                                  .default = "c")
                              ) %>%
    rename_all(to_snake_case) %>%
    filter(has_answers(.))
```

```{r load-swc-data}
## Load SWC pre and post-workshop data
## Software Carpentry Pre-Workshop Data
swcpredata <- readr::read_csv("https://raw.githubusercontent.com/carpentries/equity-and-inclusion/master/data/180521_swcpre.csv",
                              col_types = cols(
                                  Date =  col_datetime(
                                      format = "%m/%d/%y %H:%M"
                                  ),
                                  .default = "c")
                              ) %>%
    rename(
        ## ---- why_attending ----
        "why_attending_1" = WhyAttending,
        "why_attending_2" = Column4,
        "why_attending_3" = Column5,
        "why_attending_4" = Column6,
        "why_attending_5" = Column7, 
        "why_attending_other" = WhyAttendingOther, 
        ## ---- factors ----
        "factors_1" = Factors,
        "factors_2" = Column13,
        "factors_3" = Column14,
        "factors_other" = FactorsOther,
        ## ---- exposure ----
        "exposure_1" = Exposure,
        "exposure_2" = Column16,
        "exposure_3" = Column17,
        "exposure_4" = Column18,
        "exposure_5" = Column19,
        "exposure_6" = Column20,
        "exposure_7" = Column21,
        "exposure_other" = ExposureOther,
        ## ---- domain ----
        "domain_1" = Domain,
        "domain_2" = Column47,
        "domain_3" = Column48,
        "domain_4" = Column49,
        "domain_5" = Column50,
        "domain_6" = Column51,
        "domain_7" = Column52,
        "domain_8" = Column53,
        "domain_9" = Column54,
        "domain_10" = Column55,
        "domain_11" = Column56,
        "domain_12" = Column57,
        "domain_13" = Column58,
        "domain_14" = Column59,
        "domain_15" = Column60,
        "domain_16" = Column61,
        "domain_other" = DomainOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(is.na(over18) | over18 == "Yes") %>%
    filter(has_answers(.))

## Software Carpentry Post-Workshop Data
swcpostdata <- readr::read_csv("https://raw.githubusercontent.com/carpentries/equity-and-inclusion/master/data/180521_swcpost.csv",
                               col_types = cols(
                                   Date =  col_datetime(
                                       format = "%m/%d/%y %H:%M"
                                   ),
                                   .default = "c")
                               ) %>%
    rename(
        ## ---- domain ----
        "domain_1" = Domain,
        "domain_2" = Column50,
        "domain_3" = Column51,
        "domain_4" = Column52,
        "domain_5" = Column53,
        "domain_6" = Column54,
        "domain_7" = Column55,
        "domain_8" = Column56,
        "domain_9" = Column57,
        "domain_10" = Column58,
        "domain_11" = Column59,
        "domain_12" = Column60,
        "domain_13" = Column61,
        "domain_14" = Column62,
        "domain_15" = Column63,
        "domain_16" = Column64,
        "domain_other" = DomainOther
    ) %>%
    rename_all(to_snake_case) %>%
    filter(is.na(above18) | above18 == "Yes") %>%
    filter(has_answers(.))
```

```{r overview-inline-stats}
## number of learners
n_learners_pre_dc <- nrow(dcpredata)
n_learners_post_dc <- nrow(dcpostdata)
n_learners_pre_swc <- nrow(swcpredata)
n_learners_post_swc <- nrow(swcpostdata)

## time period covered
dc_dates <- range(c(dcpredata$date, dcpostdata$date))
swc_dates <- range(c(swcpredata$date, swcpostdata$date))
```

### Overview

Since `r format(min(c(dc_dates, swc_dates)), format="%B %d, %Y")`, Software and Data Carpentry have collected information on learner demographics. This analysis covers the workshops from `r format(min(swc_dates), format="%B %d, %Y")` to `r format(max(swc_dates), format="%B %d, %Y")` for Software Carpentry, and from  `r format(min(dc_dates), format="%B %d, %Y")` to `r format(max(dc_dates), format="%B %d, %Y")` for Data Carpentry.

As an overview, `r n_learners_pre_dc` and `r n_learners_post_dc` learners have responded to Data Carpentry's pre- and post-workshop surveys respectively, while `r n_learners_pre_swc` and `r n_learners_post_swc` have responded to Software Carpentry's. 

For a comprehensive look at our workshops and instructor training, have a look at our [programmatic assessment report](https://carpentries.github.io/assessment/programmatic-assessment/workshops/outputs/final_report.html).


#### Why are learners participating in our workshops?

We are interested in knowing why learners attend our workshops. Respondents were asked to check all that apply for several factors provided in the tables below.

```{r why-attending-helpers}
tally_nona <- function(x) sum(!is.na(x))
percent_nona <- function(x) round(tally_nona(x)/length(x) * 100, 1)

## Extract the relevant columns, and remove answers where repondant didn't
## select anything.
extract_multi_columns <- function(.data, column_prefix) {
    .data %>%
        select(starts_with(column_prefix),
               -matches(paste0(column_prefix, "_other")),
               -matches(paste0(column_prefix, "_open_ended"))
               ) %>%
        filter(has_answers(.))
}

summarize_multi_columns <- function(.data) {

    ## Make table of column name to question correspondance
    get_key_multi_answer <- . %>%
        gather(column_name, question) %>%
        filter(!is.na(question)) %>%
        distinct(column_name, question)

    ## Get numbers and percentage of each option
    tally_percent_multi_answer <- . %>%
        summarize_all(funs(n = tally_nona, percent = percent_nona)) %>%    
        gather() %>%
        extract(key, c("column_name", "metric"),
                regex = "([a-z_]+_[0-9]+)_(n|percent)") %>%
        spread(metric, value)

    answer_key <- .data %>%
        get_key_multi_answer

    .data %>%
        tally_percent_multi_answer %>%
        inner_join(answer_key, by = "column_name")
}

extract_percentage <- function(.data, .var, .value) {
    col_var <- enquo(.var)
    .data %>%
        filter(!!col_var == .value) %>%
        pull(percent)
}

render_table <- function(.data, col, col.names) {
    col <- enquo(col)

    .data  %>% 
        select(!! col, n, percent) %>%
        arrange(desc(n)) %>% 
        kable(format = 'markdown', row.names = NA,
              col.names =  col.names)
}

summarize_single_column <- function(.data, .var, var_levels) {
    var <- enquo(.var)
    
    .data %>%
        select(!! var) %>%
        mutate(!! quo_name(var) := replace(!!var, is.na(!!var),
                                           "Didn't answer")) %>%
        count(!!var) %>%
        right_join(expand(., !! quo_name(var) := na.omit(var_levels)),
                   by = quo_name(var)) %>%
        replace_na(list(n = 0)) %>% 
        mutate(percent = round(n/sum(n) * 100, 1)) %>%
        arrange(factor(!!var, levels = var_levels)) 
}

transform_likert_labels <- function(.data) {
    .data$results$Item <- convert_label(.data$results$Item)
    names(.data$items) <- convert_label(names(.data$items))
    .data
}


```

```{r dc-why-attending}
## Why are you attending this workshop?
dc_why_attending_data <- dcpredata %>%
    extract_multi_columns("why_attending")

dc_why_attending <- dc_why_attending_data %>%
    summarize_multi_columns()

### inline statistics
n_dc_why_attending <- nrow(dc_why_attending_data)

## percent of DC learners coming to learn skills they will use in the future (in
## column 'why_attending_1').
p_work_future <- dc_why_attending %>%
    extract_percentage(column_name, "why_attending_1") 

## table
dc_why_attending %>%
    render_table(
        question,
        col.names = c(
              paste0(
                  "Why learners attend Data Carpentry workshops? (n = ",
                  n_dc_why_attending, ")"),
            "n", "%")
    )
```

`r p_work_future`% of Data Carpentry learners attend workshops to learn skills they can apply to their current work.

```{r swc-why-attending}
# Why are you attending this workshop?
swc_why_attending_data <- swcpredata %>%
    extract_multi_columns("why_attending")
    
swc_why_attending <- swc_why_attending_data %>%
    summarize_multi_columns()

### inline statistics
n_swc_why_attending <- nrow(swc_why_attending_data)

## percent SWC learners coming to learn new/additional topics (in column
## 'why_attending_2').
p_swc_why_attending <- swc_why_attending %>%
    extract_percentage(column_name, "why_attending_2")

## table
swc_why_attending %>%
    render_table(
        question, 
        col.names = c(
              paste0("Why learners attend Software Carpentry Workshops? (n = ",
                     n_swc_why_attending, ")"),
            "n", "%")
    )
```	


```{r first-timers-swc}
# 1st time attending 
# Software Carpentry: Will this be your first time attending a SWC workshop (as a learner)?

swc_first_timers <- swcpredata %>%
    summarize_single_column(first_time, c("Yes", "No", "Didn't answer"))

p_first_timers <- swc_first_timers %>%
    extract_percentage(first_time, "Yes")

swc_first_timers %>%
    render_table(
        first_time, 
        col.names = c ("Software Carpentry 1st Time Learners", "n", "%")
    )
```

```{r dc-exposure}
## How did you find out about this workshop? 
dc_exposure_data <- dcpredata %>%
    extract_multi_columns("exposure")

dc_exposure <- dc_exposure_data %>%
    summarize_multi_columns()


dc_exposure_mailing <- dc_exposure %>%
    extract_percentage(column_name, "exposure_1") # mailing lists

dc_exposure %>%
    render_table(
        question, 
        col.names = c(
            paste0("How respondents find out about Data Carpentry workshops (n =",
                   nrow(dc_exposure_data),
                   ")"), "n", "%")
    )
```

```{r swc-exposure}
## How did you find out about this workshop? 
swc_exposure_data <- swcpredata %>%
    extract_multi_columns("exposure")

swc_exposure <- swc_exposure_data %>%
    summarize_multi_columns()

swc_exposure_mailing <- swc_exposure %>%
    extract_percentage(column_name, "exposure_3")  # mailing lists + flyers

swc_exposure %>%
    render_table(
        question, 
        col.names = c(
            paste0("How respondents find out about Software Carpentry workshops (n = ",
                   nrow(swc_exposure_data), ")"), 
            "n", "%"))
```

### Workshop Type 

```{r dc-workshop-type}
# Workshop topics
# Data Carpentry: Which workshop are you attending?
workshop_types <- c("Ecology", "Genomics", "Reproducible Research",
                    "Social Sciences", "Geospatial", "I don't know.",
                    "Didn't answer")

dc_workshop_type <- dcpostdata %>%    
    summarize_single_column(workshop, workshop_types)

## dc_workshop_type %>%
##     kable(format = 'markdown', row.names = NA,
##           col.names = c ("Data Carpentry Workshop Type Attended", "n", "%"))
```


```{r dc-workshop-type-plot}
ggassessment_lolli(dc_workshop_type,
                   aes(y = factor(workshop, levels = rev(workshop_types)),
                       x = percent), color = "dc") +                       
    labs(
        title = "Marjority of Data Carpentry Respondents \nAttend Ecology Workshops"
    )

```	

### Operating System
```{r dc-os}
## OS 
## Data Carpentry
dc_os <- dcpredata %>%
    summarize_single_column(os, unique(pull(dcpredata, os)))

dc_os_mac <- dc_os %>%
    extract_percentage(os, "Apple/Mac OS")

dc_os_win <- dc_os %>%
    extract_percentage(os, "Windows") 

dc_os_lin <- dc_os %>%
    extract_percentage(os, "UNIX/Linux")

## Table
dc_os %>%
    render_table(
        os, 
        col.names = c("Operating System Respondents Use in Data Carpentry Workshops",
                      "n", "%"))
```

### Tools Learned
```{r dc-workshop-language}	
## Language covered 
## Data Carpentry: Which programming language is being covered?
workshop_language <- c("R", "Python", "I don't know./I don't remember.",
                       "Neither", "Didn't answer")

dc_programming_language <- dcpostdata %>%
    summarize_single_column(programming_language, workshop_language)

dc_programming_language_r <- dc_programming_language %>%
    extract_percentage(programming_language, "R") 

dc_programming_language_py <- dc_programming_language %>%
    extract_percentage(programming_language, "Python") 

dc_programming_language %>%
    render_table(
        programming_language, 
        col.names = c("Data Carpentry: Language Covered in Workshops", "n", "%"))

```

### Accessibility
```{r dc-accessibility}
## Accessibility Data Carpentry: Were there any accessibility issues that
## affected your ability to participate in this workshop?
dc_accessibility <- dcpostdata %>%
    summarize_single_column(accessibility_issues, c("No", "Yes", "Didn't answer"))

dc_accessibility_percent <- dc_accessibility %>%
    extract_percentage(accessibility_issues, "Yes")

dc_accessibility %>%
    render_table(
        accessibility_issues,        
        col.names = c("Data Carpentry Respondents Having Accessibility Issues",
                      "n", "%"))
```

Data Carpentry's respondents were asked if they had accessibility issues, and `r dc_accessibility_percent`% reported they did. After reading the open-ended responses, we see that the issues were related to not being able to hear and/or see in the back of the room. 

### Recommending Carpentries Workshops
We use the [Net Promoter Score](https://en.wikipedia.org/wiki/Net_Promoter) to measure learners' likelihood of recommending workshops to a friend or colleague. The scoring for this question is on a 0 to 100 scale. Respondents scoring from 0 to 64 are labeled *Detractors*, and are believed to be less likely to recommend a workshop. Those who respond with a score of 85 to 100 are called *Promoters*, and are considered likely to recommend a workshop. Respondents between 65 and 84 are labeled *Passives*, and their behavior falls in the middle of Promoters and Detractors.

```{r dc-nps}
compute_nps <- . %>%
    pull(likely_to_recommend) %>%
    as.numeric() %>% 
    npc(breaks = list(0:64, 65:84, 85:100)) %>%
    data_frame(category = .) %>%
    mutate(category = as.character(category),
           category = replace_na(category, "Didn't answer")) %>% 
    count(category) %>%
    mutate(percent = round(n / sum(n) * 100, 1)) %>%
    arrange(category = factor(category,
                              levels = c("Promoter", "Passive",
                                         "Detractor", "Didn't answer")))
compute_nps_percent <- . %>%
    filter(category != "Didn't answer") %>%
    mutate(p = round(n / sum(n) * 100, 1)) %>%
    filter(category == "Promoter") %>% 
    pull(p) 


## NPS 
## Data Carpentry
dc_nps  <- dcpostdata %>%
    compute_nps

dc_nps %>%
    render_table(
        category, 
        col.names = c("Data Carpentry Net Promoter Score", "n", "%")
    )

dc_nps_promoters <- dc_nps %>%
    compute_nps_percent
```

`r dc_nps_promoters`% of Data Carpentry respondents who answered this question are promoters (i.e. would recommend a workshop). 

```{r swc-nps}
# NPS
# Software Carpentry
swc_nps <- swcpostdata %>%
    mutate(likely_to_recommend = as.numeric(likely_to_recommend) * 10) %>%
    compute_nps

swc_nps_percent <- swc_nps %>%
    compute_nps_percent
```

For Software Carpentry respondents who answered this questions, `r swc_nps_percent`% are promoters.

### Breakdown by Country
```{r dc-country-workshops}
## Data Carpentry learners are asked what country their workshop is held.
## Tally Data Carpentry's pre-workshop respondents by Country
dc_country <- dcpredata %>%
    group_by(country) %>%
    tally(sort = TRUE) %>%
    mutate(percent = round(100 * (n/sum(n)), 1)) %>% # add the % col
    filter(!is.na(country))

get_dc_country_percent <- function(country_var, .data = dc_country) {
    extract_percentage(.data, .var = country, .value = country_var)
}

```

```{r dc-country-workshop-plot, fig.height=9}		
## Plot Data Carpentry's respondents by Country
ggassessment_lolli(dc_country,
                   aes(y = reorder(country, percent),
                       x = percent),
                   color = "dc") +
    labs(
        title="Breakdown of Data Carpentry's Survey Respondents by Country")
```

```{r swc-country-workshop}
## Tally Software Carpentry's pre-workshop respondents by Country
swc_country <- swcpredata %>% 
    mutate(us_workshop = replace(us_workshop, is.na(us_workshop),
                                 "Didn't answer")) %>% 
    count(us_workshop, sort = TRUE) %>% 
    mutate(percent = round(100 * (n/sum(n)), 1))

swc_in_us <- swc_country %>%
    filter(us_workshop == "Yes") %>%
    pull(percent)

swc_country %>%
    render_table(
        us_workshop, 
        col.names = c("Software Carpentry Workshops in US", "n", "%"))
```

In Software Carpentry's pre-workshop survey, respondents are asked whether or not their workshop takes place in the United States. `r swc_in_us`% of respondents attended a U.S. workshop.

### Breakdown by Discipline
```{r dc-discipline}
## Domain 
## Tally Data Carpentry's pre-workshop respondents by Discipline
## Responses are in columns 'Discipline' through 'Column13'
dc_discipline_data <- dcpredata %>%
    extract_multi_columns("discipline")

dc_discipline <- dc_discipline_data %>%
    summarize_multi_columns()

get_dc_discipline_percent <- function(discipline_var, .data = dc_discipline) {
    extract_percentage(.data, .var = column_name, .value = discipline_var) 
}

dc_discipline %>%
    render_table(
        question, 
        col.names = c("Data Carpentry's Respondents by Discipline", "n", "%")
    )
```

```{r swc-discipline}
# Tally Software Carpentry's pre-workshop respondents by Discipline
# Responses are in columns 'Domain' through 'Column61'
swc_discipline_data <- swcpredata %>%
    extract_multi_columns("domain")

swc_discipline <- swc_discipline_data %>%
    summarize_multi_columns()
    
swc_discipline %>%
    render_table(
        question, 
        col.names = c("Software Carpentry's Respondents by Discipline", "n", "%"))
```


### Breakdown by Career Stage
```{r dc-status}
# Position/Status
# Data Carpentry Respondents by Status
# Responses are in columns 'Status' through 'Column22'
dc_status_levels <- c("Undergraduate Student", "Graduate Student",
                      "Postdoctoral Researcher", "Faculty", "Industry Employee",
                   "Government Employee", "Research Staff",
                   "Management/Administrator", "Retired/Not Employed",
                   "Other (please specify)")

dc_status_data <- dcpredata %>%
    extract_multi_columns("status")

dc_status <- dc_status_data %>%
    summarize_multi_columns()

get_dc_status_percent <- function(status_var, .data = dc_status) {
    extract_percentage(.data, .var = column_name, .value = status_var)
}

dc_status %>%
    render_table(
        question, 
        col.names = c("Data Carpentry's Respondents by Career Stage", "n", "%")
    )
```

```{r swc-status}
## Software Carpentry Respondents by Position/Status
swc_status_levels <- c(    
    "Undergraduate Student",
    "Graduate Student",
    "Post-doctoral researcher",
    "Faculty",
    "Research staff (including research programmer)",
    "Support staff (including technical support)",
    "Librarian/archivist",
    "Commercial software developer",
    "Other (please specify)",
    "Didn't answer"
    )

swc_status <- swcpredata %>%
    summarize_single_column(status, swc_status_levels)

get_swc_status_percent <- function(status_var, .data = swc_status) {
    extract_percentage(.data, .var = status, .value = status_var)
}
```

```{r dc-status-plot}
## Data Carpentry plot of learners by position/status
ggassessment_lolli(dc_status,
                   aes(y = factor(question, levels = rev(dc_status_levels)),
                       x = percent), color = "dc") +
    labs(
        title = "Data Carpentry Respondents by Career Stage"
    )
```

```{r swc-status-plot}
# Plot for Software Carpentry Respondents by Position/Status
ggassessment_lolli(swc_status,
                   aes(
                       y = factor(status, rev(swc_status_levels)),
                       x = percent
                   ), color = "swc") +
    labs(
        title = "Software Carpentry Respondents by Career Stage"
    )
```

### Gender and Racial/Ethnic Identity Demographics

```{r dc-gender}
# Gender Identity 
# Data Carpentry
# With what gender do you most identify?
dc_gender_levels <- c("Female", "Male", "Transgender female",
                      "Transgender male", "Gender variant/non-conforming",
                      "Prefer not to answer", "Didn't answer")

dcpredata$gender_identity <- iconv(dcpredata$gender_identity, "latin1", "ASCII",
                                   sub=" ")

dc_gender <- dcpredata %>%
    filter(country == "United States of America") %>% 
    summarize_single_column(gender_identity, dc_gender_levels) 


dc_gender %>%
    render_table(
        gender_identity, 
        col.names = c("Data Carpentry's U.S. Respondents' Gender Identity",
                      "n", "%"))
```

```{r dc-ethnicity}
# Data Carpentry: Race/Ethnic Identity
# Responses are in columns 'RaceEthnicIdentity' through 'Column49'
dc_ethnicity_data <- dcpredata %>%
    filter(country == "United States of America") %>%
    extract_multi_columns("ethnic_identity")

dc_ethnicity <- dc_ethnicity_data %>%
    summarize_multi_columns()

dc_ethnicity %>%
    render_table(
        question, 
        col.names = c("Data Carpentry's U.S. Respondents Racial/Ethnic Identity",                      
                      "n", "%"))
```

```{r swc-gender}
# Software Carpentry
# With what gender do you most identify?
swc_gender_levels <- c("Female", "Male", "Other", "Prefer not to say")

swc_gender <- swcpredata %>%
    filter(us_workshop == "Yes") %>% 
    summarize_single_column(gender, swc_gender_levels)

swc_gender %>%
    render_table(
        gender, 
        col.names = c("Software Carpentry's U.S. Respondents' Gender Identity",
                      "n", "%"))

```

```{r swc-ethnicity}
# Software Carpentry: Race/Ethnic Identity
swc_ethnicity_levels <- c("American Indian or Alaskan Native",
                          "Asian / Pacific Islander",
                          "Black or African American", "Hispanic or Latino",
                          "Native Hawaiian or Other Pacific Islander",
                          "White / Caucasian", "Prefer not to say",
                          "Multiple ethnicity / Other (please specify)")

swc_ethnicity <- swcpredata %>%
    filter(us_workshop == "Yes") %>% 
    summarize_single_column(race, swc_ethnicity_levels)

swc_ethnicity %>%
    render_table(
        race, 
        col.names = c("Software Carpentry's U.S. Respondents' Racial/Ethnic Identity",
                      "n", "%"))

```