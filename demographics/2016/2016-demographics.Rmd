## 2016 Demographics for Software Carpentry Learners
__Revised:__ 2018-02-28    
__Lead:__ [Kari L. Jordan](https://github.com/kariljordan), Director of Assessment and Community Equity 

```{r setup, include=FALSE} 
library(knitr)
library(tidyverse)
library(likert)
opts_chunk$set(echo = FALSE,
               message = FALSE,
               warning = FALSE)
opts_chunk$set(fig.path='figures/2016_learners_') #puts all figures in figures folder
```


```{r include=FALSE}
# Loading dataset for the 2016 pre-workshop survey demographics for Software Carpentry
swc_pre_2016 <- readr::read_csv("https://raw.githubusercontent.com/carpentries/equity-and-inclusion/master/demographics/2016/2016-swc-pre-demographics.csv")
```

```{r}
# Function that makes a table of counts and percentages
# question_n is set by default to the number of respondents in the survey (5707). 
# This value may have to be set by question.
question_n <- nrow(swc_pre_2016)

tally_and_perc <- function(df, colname, na.rm = FALSE, question_n){
  quo_colname <- enquo(colname)

  df %>%
    group_by(!!quo_colname) %>%
    tally() %>%
    filter(if_else(rep(na.rm, nrow(.)),
                  !is.na(!!quo_colname),
                  as.logical(rep(1, nrow(.))))) %>%
    mutate(`%` = round(n / question_n * 100, 1))
}

# function to compute number of non-NA responses to a question

n_responses_to_the_question <- function(df, from_colname, to_colname) {

  quo_from_colname <- enquo(from_colname)
  quo_to_colname <- enquo(to_colname)

  rowsums <-
df %>%
  select(UQ(quo_from_colname):UQ(quo_to_colname)) %>%
  # check that each row has a value for at least one column
  # convert to numeric, if NA, then put a zero, otherwise 1
  map_df(., ~ifelse(is.na(.x), 0, 1)) %>%
  # sum to see if any rows have no reponses
  rowSums()

# for all behaviors
idx <- ifelse(rowsums == 0, FALSE, TRUE)
sum(idx)
}
```

The following includes demographic data for those individuals who took Software Carpentry's [pre-workshop survey](https://github.com/carpentries/assessment/blob/master/learner-assessment/surveys/swc_presurvey.pdf) in 2016. There were a total 5896 learners who completed this survey in 2016.

# First-Time Learners

__Will this be your first time attending a Software Carpentry workshop (as a learner)?__
```{r}
# Will this be your first time attending a Software Carpentry workshop (as a learner)?
first_time = c("Yes", "No")
first_time = factor(first_time)

swc_pre_2016$`First-Workshop` = factor(swc_pre_2016$`First-Workshop`, levels = first_time)

first_time_tally <-
  swc_pre_2016 %>%
  group_by(`First-Workshop`) %>%
  tally() %>%
  filter(!is.na(`First-Workshop`)) %>%
  mutate(perc = round(n/sum(n) * 100, 0)) %>%
  arrange(desc(n))

kable(first_time_tally)
# Come back and figure out how to change the column header.
```

# Exposure to Software Carpentry

__How did you hear about Software Carpentry? Check all that apply.__

```{r}
# How did you hear about Software Carpentry? Check all that apply.
# Responses are in columns 'Exposure' through 'Column21'
exposure <-
 swc_pre_2016 %>%
 select(`Exposure`:Column21) %>%
 gather(col, exposure) %>%
 group_by(exposure) %>%
 tally() %>%
 filter(!is.na(exposure)) %>%
 mutate(perc = round(n/sum(n) * 100, 0)) %>%
 arrange(desc(n)) %>%
 rename(`Exposure` = exposure)

kable(exposure)
```

# Position

__What is your current position?__

```{r position}
# What is your current position?
position = c("Undergraduate Student", "Graduate Student", "Post-doctoral researcher", "Faculty", "Research staff (including research programmer)", "Support staff (including technical support)", "Librarian/archivist", "Commercial software developer", "Other (please specify)")
position = factor(position)

swc_pre_2016$`Position` = factor(swc_pre_2016$`Position`, levels = position)

position_tally <-
  swc_pre_2016 %>%
  group_by(Position) %>%
  tally() %>%
  filter(!is.na(Position)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

ggplot(position_tally,
       aes(Position, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="maroon") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Respondents' Position") +
  ylab("% Respondents") +
  ggtitle("2016 Breakdown of Respondents by Position") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
```

# Domain

__What is your domain of research/study?__

```{r}
# What is your domain of research/study?
# Responses are in columns 'Domain' through 'Column61'

n_responses_to_domain_question <-
  n_responses_to_the_question(swc_pre_2016,
                              from_colname = Domain,
                              to_colname = Column61)

domain_percent <-
  swc_pre_2016 %>%
  select(Domain:Column61) %>%
  gather(col, domain_percent) %>%
  group_by(domain_percent) %>%
  tally_and_perc(domain_percent,
                 na.rm = TRUE,
                 question_n = n_responses_to_domain_question) %>%
  filter(!is.na(domain_percent)) %>%
  arrange(desc(n)) %>%
  rename(Domain = domain_percent)

kable(domain_percent,
      format = "markdown",
      digits = getOption("digits"),
      row.names = NA,
      col.names = NA,
    caption = NULL,
    escape = TRUE)
```

# Gender Identity

__What is your gender?__

```{r gender}
# What is your gender?
gender = c("Female", "Male", "Other", "Prefer not to say")
gender = factor(gender)

swc_pre_2016$`Gender` = factor(swc_pre_2016$`Gender`, levels = gender)

gender_test_tally <-
  swc_pre_2016 %>%
  group_by(`Gender`) %>%
  tally() %>%
  filter(!is.na(`Gender`)) %>%
  mutate(perc = round(n/sum(n) * 100, 0)) %>%
  arrange(desc(n))

kable(gender_test_tally)

swc_pre_2016 %>%
  select(`Gender`) %>%
  group_by(`Gender`) %>%
  tally() %>%
  filter(!is.na(`Gender`)) %>%
  mutate(`Race-Ethnicity` = factor(`Gender`, levels = gender)) %>%

ggplot(aes(x = `Gender`, y = 100 * (n/sum(n)))) +
geom_bar(stat = "identity", position = "dodge", fill = "maroon", na.rm = TRUE ) +
geom_text(aes(label=n), size= 4, vjust=-0.25) + # Adds count to top of bar
scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("Gender") +
    ylab("% respondents") +
    ggtitle("2016 Breakdown of Respondents by Gender") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14)
```

# Racial/Ethnic Identity (U.S. Data Only)

Per various international laws, we are only allowed to collect race/ethnicity information for learners attending workshops in the United States.

__Which race/ethnicity best describes you? (Please choose only one.)__
```{r race_ethnicity_US}
# Which race/ethnicity best describes you? (Please choose only one.)
  race = c("American Indian or Alaskan Native", 
           "Asian / Pacific Islander", 
           "Black or African American", 
           "Hispanic or Latino", 
           "Native Hawaiian or Other Pacific Islander", 
           "White / Caucasian", 
           "Prefer not to say") 
  race = factor(race)

swc_pre_2016$`Race-Ethnicity` = factor(swc_pre_2016$`Race-Ethnicity`, levels = race)

  race_tally <-
   swc_pre_2016 %>%
   group_by(`Race-Ethnicity`) %>%
   tally() %>%
   filter(!is.na(`Race-Ethnicity`)) %>%
   mutate(perc = round(n/sum(n) * 100, 0)) %>%
   arrange(desc(n))

 kable(race_tally)

swc_pre_2016 %>%
  select(`Race-Ethnicity`) %>%
  group_by(`Race-Ethnicity`) %>%
  tally() %>%
  filter(!is.na(`Race-Ethnicity`)) %>%
  mutate(`Race-Ethnicity` = factor(`Race-Ethnicity`, levels = race)) %>%

ggplot(aes(x = `Race-Ethnicity`, y = 100 * (n/sum(n)))) +
geom_bar(stat = "identity", position = "dodge", fill = "maroon", na.rm = TRUE ) +
geom_text(aes(label=n), size= 4, vjust=-0.25) + # Adds count to top of bar
scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("Race/Ethnicity") +
    ylab("% respondents") +
    ggtitle("2016 Breakdown of U.S. Respondents by Race/Ethnicity") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14)
  
```